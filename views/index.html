<!DOCTYPE html>
<html lang="en">
<head>
  <title>Data Entry</title>
  <link rel="stylesheet" href="/styles.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <style>
    .navbar {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }
    .user-info {
      color: white;
      font-size: 14px;
      margin-right: 20px;
    }
    .user-role {
      display: inline-block;
      background: rgba(255, 255, 255, 0.2);
      padding: 4px 8px;
      border-radius: 4px;
      font-size: 12px;
      font-weight: 600;
    }
  </style>
</head>
<body class="container mt-4">
  <!-- Navigation -->
  <nav class="navbar navbar-expand-lg navbar-dark">
  <div class="container-fluid">
    <a class="navbar-brand" href="/">ðŸ“Š Data Manager</a>
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarNav">
      <ul class="navbar-nav ms-auto">
        <li class="nav-item"><a class="nav-link" href="/">Home</a></li>
        <li class="nav-item"><a class="nav-link" href="/filter">Filter</a></li>
        <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>
        <li class="nav-item"><a class="nav-link" href="/all">All Records</a></li>
        <li class="nav-item"><a class="nav-link" href="/download-template">Download Template</a></li>
        <li class="nav-item"><a class="nav-link" href="/export-excel">Export Excel</a></li>
        <li class="nav-item"><a class="nav-link" href="/export-pdf">Export PDF</a></li>
        <li class="nav-item" id="adminMenuLink" style="display: none;"><a class="nav-link" href="/admin-dashboard">ðŸ‘¥ Admin</a></li>
        <li class="nav-item">
          <div class="user-info">
            <span id="username"></span>
            <span class="user-role" id="userRole"></span>
          </div>
        </li>
        <li class="nav-item"><a class="nav-link" href="/logout">Logout</a></li>
      </ul>
    </div>
  </div>
</nav>

  <div id="editorOnlySection">
    <h2>Enter New Record</h2>
    <form action="/add" method="POST" class="row g-3">
      <input name="customerName" class="form-control" placeholder="Customer Name" required>
      <input name="address" class="form-control" placeholder="Address" required>
      <input name="city" class="form-control" placeholder="City" required>
      <input name="productName" class="form-control" placeholder="Product Name" required>
      <input name="modelNo" class="form-control" placeholder="Model No" required>
      <input name="kw" type="number" step="0.1" class="form-control" placeholder="KW" required>
      <input name="tankVolume" type="number" step="0.1" class="form-control" placeholder="Tank Volume" required>
      <input name="qty" type="number" class="form-control" placeholder="Qty" required>
      <button type="submit" class="btn btn-primary">Add New</button>
    </form>

    <hr>
    <h4>Upload Excel</h4>
    <form action="/upload" method="POST" enctype="multipart/form-data">
      <input type="file" name="excel" class="form-control" required>
      <button type="submit" class="btn btn-success mt-2">Upload</button>
    </form>
  </div>

  <div id="viewerOnlyMessage" style="display: none;" class="alert alert-info">
    <strong>Viewer Mode:</strong> You have read-only access. Contact your administrator to get edit permissions.
  </div>

  <script>
    // Get user info from session (stored in page via server)
    fetch('/api/user-info', { credentials: 'include' })
      .then(res => res.json())
      .then(data => {
        if (data.username) {
          document.getElementById('username').textContent = data.username;
          document.getElementById('userRole').textContent = data.role;
          
          // Show admin link if user is admin
          if (data.role === 'Admin') {
            document.getElementById('adminMenuLink').style.display = 'block';
          }
          
          // Hide editor-only section for viewers
          if (data.role === 'Viewer') {
            document.getElementById('editorOnlySection').style.display = 'none';
            document.getElementById('viewerOnlyMessage').style.display = 'block';
          }
        }
      })
      .catch(err => console.error('Error fetching user info:', err));
  </script>
</body>
</html>
